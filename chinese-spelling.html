<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pinyin Spelling Practice 拼音听写复习</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap');

        body {
            font-family: "Inter", sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
        }
        h1 {
            margin-top: 20px;
        }
        #inputBoxContainer {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        #inputBox {
            width: 60%;
            padding: 10px;
            font-size: 18px;
            font-family: "Inter";
            text-align: center;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            font-family: "Inter";
            margin: 10px;
            border-radius: 20px;
        }
        #pinyinDisplay {
            font-size: 32px;
            margin: 20px 0;
            color: #333;
        }
        #navigationButtons {
            margin-top: 20px;
        }
        #soundIcon {
            font-size: 40px;
            cursor: pointer;
            margin-top: 10px;
            color: #007bff;
            display: none;
        }
        /* Style for account section */
        #accountSection {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
        }
        #accountIcon {
            font-size: 24px;
            margin-right: 5px;
        }
        #loginText {
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="accountSection">
        <span id="accountIcon" class="material-icons">account_circle</span>
        <span id="loginText" onclick="redirectToLogin()">Login</span>
    </div>

    <h1>Pinyin Spelling Practice 拼音听写复习</h1>
    <div id="inputArea">
        <div id="inputBoxContainer">
            <input type="text" id="inputBox" placeholder="输入中文单词 Enter Chinese Phrases" />
        </div>
        <h5>Seperated the phrases by comma or spaces 以逗号或空格分隔</h5>
        <button id="startBtn" onclick="toggleSpelling()">Start Spelling 开始听写</button>
    </div>
    <div id="pinyinDisplay"></div>
    <span id="soundIcon" class="material-icons" onclick="playSound()">volume_up</span>

    <div id="navigationButtons">
        <button id="prevBtn" onclick="showPrev()" disabled>Previous 前一个</button>
        <button id="nextBtn" onclick="showNext()" disabled>Next 下一个</button>
    </div>

    <script>
        let chineseWords = [];
        let pinyinWords = [];
        let currentIndex = -1;
        let shownWords = [];
        let currentSoundURL = '';
        let isSpelling = false;

        const toneMap = {
            1: { 'a': 'ā', 'e': 'ē', 'i': 'ī', 'o': 'ō', 'u': 'ū', 'ü': 'ǖ' },
            2: { 'a': 'á', 'e': 'é', 'i': 'í', 'o': 'ó', 'u': 'ú', 'ü': 'ǘ' },
            3: { 'a': 'ǎ', 'e': 'ě', 'i': 'ǐ', 'o': 'ǒ', 'u': 'ǔ', 'ü': 'ǚ' },
            4: { 'a': 'à', 'e': 'è', 'i': 'ì', 'o': 'ò', 'u': 'ù', 'ü': 'ǜ' },
        };

        // Function to convert Pinyin with numbers to Pinyin with tones
        function convertToTone(pinyin) {
            const regex = /([aeiouü]+)([1-5])/;
            const match = pinyin.match(regex);
            if (!match || match[2] === '5') {
                return pinyin.replace(/[1-5]/, '');
            }
            const [_, vowelGroup, tone] = match;
            const toneNumber = parseInt(tone, 10);
            let vowelToReplace = vowelGroup.includes('a') ? 'a'
                : vowelGroup.includes('o') ? 'o'
                : vowelGroup.includes('e') ? 'e'
                : vowelGroup[0];
            const markedVowel = toneMap[toneNumber][vowelToReplace];
            return pinyin.replace(vowelToReplace, markedVowel).replace(/[1-5]/, '');
        }

        // Function to decode Base64 email
        function decodeBase64(encodedString) {
            try {
                return atob(encodedString);
            } catch (error) {
                console.error('Error decoding Base64:', error);
                return null;
            }
        }

        // Function to check for ?auth in URL
        function checkForAuth() {
            const urlParams = new URLSearchParams(window.location.search);
            const authParam = urlParams.get('auth');
            if (authParam) {
                const email = decodeBase64(authParam);
                if (email) {
                    document.getElementById('loginText').textContent = email;
                }
            }
        }

        // Redirect to login page
        function redirectToLogin() {
            window.location.href = 'https://enviro500.github.io/beta/login?chinese-spelling';
        }

        // Run the checkForAuth function on page load
        window.onload = function() {
            checkForAuth();
        };

        // Remaining Pinyin Spelling Code...
    </script>

</body>
</html>
